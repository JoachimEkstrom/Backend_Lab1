<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 1 - Public site</title>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        let valdValLokal = 'alla'
        document.addEventListener("DOMContentLoaded", () => {
            socket = io('http://localhost:8080');
            socket.on('hello', (data) => {
                console.log('Connected to server')
                socket.emit('updateMe', valdValLokal )
            })

            socket.on('updates', (valresultat) => {
                
                console.log(valresultat)
                document.getElementById('valLokal').innerHTML = valresultat.valLokal
                document.getElementById('allmannaPartiet').innerHTML = valresultat.allmannaPartiet
                document.getElementById('speciellaPartiet').innerHTML = valresultat.speciellaPartiet
                document.getElementById('skarskildaPartiet').innerHTML = valresultat.skarskildaPartiet
                document.getElementById('ovrigaRoster').innerHTML = valresultat.ovrigaRoster
                document.getElementById('ogiltligaRoster').innerHTML = valresultat.ogiltligaRoster
                getPercentages(valresultat)
            })
            let lista = document.getElementById("selector")
            lista.addEventListener("change", () => {
                getVotes(lista.options[lista.selectedIndex].value)
            })

            socket.on('lokaler', (vallokaler) => {
                let a = []
                console.log(vallokaler)
                for( let i = 0; i < vallokaler.length; i++){
                    if (document.getElementById(vallokaler[i])) {
                        console.log('Element exists, skipping to next')
                    } else {
                    a = document.createElement("option")
                    a.setAttribute("value", vallokaler[i])
                    a.setAttribute("id", vallokaler[i])
                    a.innerText = vallokaler[i]
                    lista.appendChild(a)      
                    }
                }

            })
            


    })  
    function getVotes(vallokal) {
            socket.emit('updateVallokal', vallokal)
            console.log('Getting votes for: ' + vallokal)
        }

    function getPercentages(valresultat){
        let totalaRoster = valresultat.allmannaPartiet + valresultat.speciellaPartiet + valresultat.skarskildaPartiet + valresultat.ovrigaRoster + valresultat.ogiltligaRoster

        document.getElementById('allmanna%').innerHTML =  ' vilket ger ' + ((valresultat.allmannaPartiet / totalaRoster) * 100).toFixed(1) + '% av det totala antalet röster.'
        document.getElementById('speciella%').innerHTML =  ' vilket ger ' + ((valresultat.speciellaPartiet / totalaRoster) * 100).toFixed(1) + '% av det totala antalet röster.'
        document.getElementById('skarskilda%').innerHTML =  ' vilket ger ' + ((valresultat.skarskildaPartiet / totalaRoster) * 100).toFixed(1) + '% av det totala antalet röster.'
        document.getElementById('ovriga%').innerHTML =  ' vilket ger ' + ((valresultat.ovrigaRoster / totalaRoster) * 100).toFixed(1) + '% av det totala antalet röster.'
        document.getElementById('ogiltliga%').innerHTML = ' vilket ger ' + ((valresultat.ogiltligaRoster / totalaRoster) * 100).toFixed(1) + '% av det totala antalet röster.'
        document.getElementById('total').innerHTML = totalaRoster
    }

    </script>
</head>
<body>
    <h1>Välkommen till valsidan!</h1>

    <select id="selector">
        <option value="alla">Alla lokaler</option>
    </select>

    <h2>Du kollar nu på vallokalen: <span id="valLokal"></span></h2>
    <h3>Antalet röster på allmänna partiet: <span id="allmannaPartiet"></span><span id="allmanna%"></span></h3>
    <h3>Antalet röster på speciella partiet: <span id="speciellaPartiet"></span><span id="speciella%"></span></h3>
    <h3>Antalet röster på skärskilda partiet: <span id="skarskildaPartiet"></span><span id="skarskilda%"></span></h3>
    <h3>Antalet övriga röster: <span id="ovrigaRoster"></span><span id="ovriga%"></span></h3>
    <h3>Antalet ogiltliga röster: <span id="ogiltligaRoster"></span><span id="ogiltliga%"></span></h3>


    <h3>Totalt antal röster: <span id="total"></span></h3>
    
    
</body>
</html>